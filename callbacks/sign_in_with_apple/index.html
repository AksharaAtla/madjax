<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Apple Sign-In Redirect</title>
  <script>
    window.onload = function () {
      const search = window.location.search || window.location.hash.substring(1);
      const params = new URLSearchParams(search);

      const code = params.get("code");
      const idToken = params.get("id_token");
      const state = params.get("state");
      const error = params.get("error");

      if (error) {
        document.body.innerHTML = `<h2>Sign in failed: ${error}</h2>`;
        return;
      }

      if (code || idToken) {
        const redirectURL = `madjax://signin-success?code=${encodeURIComponent(code || "")}&id_token=${encodeURIComponent(idToken || "")}&state=${encodeURIComponent(state || "")}`;
        window.location.href = redirectURL;
        document.body.innerHTML = `<h2>Login successful. Redirecting...</h2>`;
      } else {
        document.body.innerHTML = "<h2>No credentials received.</h2>";
      }
    };
  </script>
</head>
<body>
  <h2>Processing Sign-In...</h2>
</body>
</html>
